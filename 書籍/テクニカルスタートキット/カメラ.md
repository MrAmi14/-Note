# カメラ

## レンズの基本 P4～

レンズを通る光には以下3つの点を満たす
- レンズの中心をとおる
- レンズの軸と並行に通る光は、レンズによって屈折し、焦点を通る
- 手前の焦点を通った光は、レンズで屈折すると平行光になる

レンズの中心から被写体までの距離を`a`  
レンズを通った光が像を結ぶ面までの距離を`b`  
終点距離を`f`   
とすると、次の式が成り立つ。  
### ` 1/a + 1/b = 1/f`

---

## 画角　P6～
- 画角θの求め方  
カメラにうつす水平軸をWとすると

### ` θ = 2 * arctan(L / 2f)`
 L = カメラの口径の大きさ(アパーチャ) `水平アパーチャと垂直アパーチャあるよ`  
 f = 焦点距離

 ちな、`画角を使った撮影範囲の求め方`  
 **撮影可能範囲 = (tanθ(画角/2) * 撮影距離 * 2)**  

 水平アパーチャを使用し、撮影可能範囲を計算した後は、`比率で垂直の撮影可能範囲を計算可能`  
 **(垂直)撮影可能範囲 = (水平)撮影可能範囲 * (垂直アパーチャ / 水平アパーチャ)**

 [詳しくはこちら](https://systemk-camera.jp/camera-blog/knowledge/shooting-range-calculation.php)

---
 ## 被写界深度
 被写界深度とは、`ピントがあっているように見える範囲`のこと。  
 ピントがあっている範囲が広いと`被写界深度が深い`といい、逆に狭いと`被写界深度が浅い`という。

||浅い|深い|
|:-|:-|:-|
|焦点の合う距離|短い|長い|
|焦点の距離|長い(望遠)|短い(広角)|
|絞りの開き|開く|閉じる|
|被写体までの距離|近く|遠く|
|被写体と背景の距離	|遠く|近く|
---

## シャッターと絞り　P7～
- シャッター

取り込まれる光の量はシャッターが開いている時間にほぼ比例する。  

|シャッター開きの長さ|明るさ|ブラー|
|:-|:-|:-|
|長い|明るい|多い|
|短い|暗い|少ない（くっきり）|

映画撮影とかで使われるカメラはシャッターの一部が欠けていてそれを回転しているイメージ。  
定期的に決まった露光時間で撮影できる。

円板が1周するごとに1露光、つまり1フレーム撮影される。  
`24フレーム / 1`だと`1秒に24周`するということ。

- 絞り

光が入り込む入り口を小さくすることで光の量を調節する機能。  
絞りを絞る、つまり光の入り口を小さくすると、暗くなり、`被写界深度`が深くなる

絞りの調整具合は`F値`と呼ばれる数字を用いて示される。  
`1.414(sqrt(2))`刻みの数字で表されることが多く  
1,1.4,2,2.8,4,5.6...........  
数値が多きなると絞りも大きくなる（入り口が小さくなる）

- アパーチャ

`スクリーンサイズ`みたいなもん

---

## CGカメラの仕組み P10～

- ピンホールカメラモデル  
多くの場合、CGのカメラは`ピンホールカメラモデル`と呼ばれるカメラモデルを使っている。  
レンズがなく、非常に小さい穴を通って映像素子に光が入り込み、屈折もせず一方向からしか光が届かないので  
全てのオブジェクトに焦点があう。  
`焦点距離`は現実のカメラとの整合性を保つために、画角とフィルムサイズから求められたりする。


- 透視撮影と平行撮影  
    - 平行撮影  
        CG特有のもので、すべての光は平行にスクリーンに投影される。  
        つまり、投影されたスクリーン上の画像には奥行きによる大きさの変化はない。  
        mayaの前面ビュー的な

    - 透視撮影  
    スクリーンに投影される光が放射状に集まってくる。  
    遠くにあるほど小さく、近くにあるほど大きくうつる。普通だな。  

- クリッピングプレーン  
ニアクリッピーングプレーンとファークリッピングプレーンが存在し、それに挟まれた  
領域にあるオブジェクトだけがレンダリングされる。  

---

## カメラパラメータの画像への影響

- ボケ  
焦点が合っておらず、像がぼやけている現象。  
スクリーン手前で光が交わった後、少し拡散してしまってからスクリーンに到達する。  
そのため、一つの点から出た光が画像中では1つの点ではなく少し広い領域に分散する。これがぼけの起こる仕組み。

- 被写界深度  
許容できる範囲のボケ具合。  
この焦点の合う範囲を被写界深度という。  
`絞りが大きいほど広く`、`絞りが小さいほど狭い。つまり焦点の合う範囲が広い`

- モーションブラー  
シャッターが開いている間に被写体やカメラが動くとぶれた画像が撮影される。これを`モーションブラー`という  
どれだけブラーがかかるかはシャッタースピード/アングルの値に応じて変わる。  
MAYAのデフォルト設定では、`現在のフレームを中心(0秒)として-0.5フレームから0.5フレームの間の時間を最大`とし、  
シャッターアングルに応じた分のブラーがかかる。

- レンズのひずみ  
実際のカメラではレンズの特性によって画像にひずみ(ディストーション)が生じる。  
ひずみには2種類ある。  
    - 樽型収差(ひずみ)  
    外側に膨らむ  
    - 糸巻き型収差(ひずみ)  
    内側にへこむ

---

## 座標系

- `極座標系`  
原点からの距離`r`と2つの回転角度`θ`、`φ`で空間中の点を示す。  
    - θ 緯度   ：縦よ。南緯、北緯
    - φ 経度   ： 横よ。東経、西経。

    3次元の直交座標系の点(x,y,z)と極座標系中の点(r,θ,φ)は、以下の計算式によって変換できる。  
    ```
    x = r cosφ cosθ
    y = r sinφ
    z = r cosφ sinθ
    ```  

- `座標系の階層関係`  
複数の座標系が存在する場合、その変換を行うのに`行列を使うと便利`  
座標系Aと座標系Bにおいて、座標系Aの点Pを`Pa`、座標系Bの点Pを`Pb`とすると、  
PbからPaの変換を行うための行列`Mb→a`を用いて、次式のようにあらわされる。
    ```
    Pa = Pb × Mb→a
    ```

    行列は`座標系の変換が可能で行列を使うと簡単だよ`という認識あとでしらべえる

- `CGで使われる様々な座標系`  
    - ワールド座標  
    全ての基準。絶対的な位置。

    - ローカル座標(オブジェクト座標)  
    オブジェクト毎に定義された座標系。原点はオブジェクトの中心だったり底面だったりする。  

    MayaではTransformノードが世界座標系とオブジェクト座標系との関係(平行移動、回転、拡縮)を表し、  
    そのオブジェクト座標系の中にShapeノード(形状情報)が定義されている。

    - カメラ座標系  
    カメラを基準とした座標系。カメラの中心を原点とし、視線方向が+Z、上方向が+Y、  
    その2つの外積で求められる方向が+X。mayaではカメラ方向を-zとなる。  
    カメラ座標はクリッピングプレーンの計算やLODの計算で使うオブジェクトの距離との計算に使う。

    - スクリーン座標系  
    横方向にX軸、縦方向にY軸をとる。左上の角を原点とし、右下にいくほどxyの値が増える。  
    スクリーン座標系は投影計算が終わった後の座標系なので二次元空間だす。  
    アウトラインの太さを一定に保ちたいとかだと、キャラクターが前に言っても後ろにいっても同じ太さにできるよ。

    - オブジェクトUVとテクスチャUV  
        - オブジェクトUV  
        オブジェクUV座標系はユーザーがオブジェクトに値を割り当てる。  
        この割り当てたz表敬はテクスチャのどこの色の位置を持ってくるか決めるもの。

        - テクスチャ座標系  
        オブジェクトUV座標系でオブジェクトに割り当てられた値とテクスチャを結びつける役割をする。  
        主に二つの変数`s`と`t`で表される。

---

