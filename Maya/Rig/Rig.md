# mayaリギングの本メモ


## ノードの基礎

## ノードには2種類ある
- トランスフォーム  
移動、回転、スケール情報を持っているノード
- シェイプノード  
オブジェクトのすべての入力情報を受け取り、最終的なルックを決定する。

## トランスフォームノードとシェイプノードの見つけ方

ウィンドウ　＞　アウトライナでアウトライナを表示。  
モデルのノードをクリックして、チャネルボックスを開くとそこにあるよ。   
シェイプはその下にありますね。  
アウトライナ ＞ ディスプレイからシェイプにチェックをつけると、モデルの横に+ができるので  
その+を押すとシェイプののーどがでるみたいです。

---

## ハイパーグラフ
モデルを選択した状態で、`ウィンドウ ＞ 一般エディタ ＞ ハイパーグラフ階層`  
ちな、シェイプノードの出し方はオプション ＞ ディスプレイ ＞ シェイプノードにチェックをいれましょう

---

## ピボット
原点のこと。オブジェクト選択して移動させるやつにしてInsertキーを押すといいよ。  
もしくはDおしっぱで、推している間だけピボット操作できる。

---
## トランスフォームのフリーズ
ヒストリの削除
オブジェクトを選択して、`修正 ＞ トランスフォームのフリーズ`  
でトラスフォームノードのアトリビュートが全て０や１に代わる

---

## グループノード
オブジェクトを選択して　`編集 ＞ グループ化`　で作成。アウトライナに出てくるよ。  
グループノードはシェイプノードのないただのトランスフォームノードらしいです。選択したオブジェクトの親。  
可視要素がないので、チャネルボックスには入力がないどす。  
空のトランスフォームノードなのでアニメーターがアニメートするには最適のノードらしいっす

## アニメーションキー
Sキーを押すとキーフレームを追加できる。下にタイムラインあります。
キーフレームを削除するには、指定のキーまで移動して右クリック→削除

---
## 親子付け
アウトライナで`ノードを中ボタンドラッグ＆ドロップ`すると簡単にオブジェクトをペアレント化、  
ペアレント化解除ができます。
もしくは、ハイパーグラフ階層ウィンドウでも同じことができるよ。中ボタンドラッグでくっつける。

親を量産するにはグループをたくさん作ろう。

親になっているグループノードを動かすと子も動くよ。
子が動いても親は動かないよ。

---

## リグの基礎知識
移動ノードは他のノードすべてに影響の与えるので、常に一番上にないとダメよ  
子ノードを移動させることもできるけど、親とリグが離れちゃうよ

相手に渡すときは、アニメーションしないアトリビュートは全部ロックしてあげよう。

---
## オブジェクト表示非表示
- 表示
Shift + H
- 非表示
Ctrl + H
---

# デフォーマ

## デフォーマの追加

オブジェクトを選択して　`デフォーマ ＞ ノンリニア ＞ ベンド`を選択。  
曲げるには十分なテレセーションが必要なので注意。

## 色んなでフォーム
- ベンド  
モデルを曲げる
- スカッシュ  
モデルを潰したり  
- 波形  
モデルに波を打たせる

これらの係数とかをいじってアニメーションさせる。はず。

---


## 変形順序  
これらのデフォーマを追加した際に、作成した順序でノードが繋がれている。これ大事  
順序が違うと思っていた結果にならないことも。

この順序を途中で入れ替えるには、  
`オブジェクトを選択 ＞ 入力 ＞ すべての入力...　＞ ウィンドウの中のデフォーマを中クリックで移動させる。`

ちなみにデフォーマの順序は下から順に始まります。

---

# 3章

まずはリグの仕様、つまりリグのできることのリストを作ろう

- BendHigh(上部のベンド)
- BendLow(下部のベンド)
- ツイスト
- 移動、回転
- スケール

---
## アニメーションコントローラーの作成手順

- カーブ/サーフェスからNURBS円を作成
- 次数を１時、セクションを４にすると四角形に
- 終わったらトランスフォームのフリーズとヒストリの削除

コントローラー接続手順
- ジオメトリをクリックしてハイパーグラフ接続を開く
- アウトライナからCONTRLを選択して、ハイパーグラフ内にあるbend1(接続したいやつの入力)をShift＋クリック
- ウィンドウ > 一般エディタ > 接続エディタをクリック。左側にCNTRLがくればOK。
- CNTRLのtranslateをつなげたい場合は左側はtranslateをクリックして、右側はcurvatureをクリック

---

## ハイパーシェードのすすめ

コントローラーの移動値を１０べえにして曲率をいじる手順
- mayaの変なアイコンをクリックするとハイパーシェード画面に
- いじりたいノードを複数選択して、⇒⇒をクリック
- コントローラーノードの移動値の出力値をとります（移動から右側の丸を引っ張る）
- multiplyDivideを作ります。
- 入力1に値を、Input2に乗算値、出力をそのままbend1の曲率にぴっ
---

## 移動制限
アトリビュートエディタでやるといいよ。  
- 制限かけたいノードを選んで、アトリビュートエディタを開く(ctrl + A)  
- 制限情報から設定

---
## コンストレイントの追加

- MainCNTRLを作成（NURBS円）  
- MainCNTRL→Move_GRPと選択して`コンストレイント > ペアレント`  
コンストレイントは左上にあるモードをモデリングからリギングもしくはアニメーションにしよう  
`移動、回転、拡縮のコントローラーにはコンストレイントを追加しよう`

---

## アニメーションは低解像度で
ローポリにしたいジオメトリを選んで  
`メッシュ > スムーズ`で分割数を0に。

---
## アトリビュートの追加

`チャネルボックス > 編集 > アトリビュートの追加`  
ハイパーシェードとかで何かに繋げて新しいコントローラーにしよう。

列挙型の使い方は  
コマンドをクリック > 新しい名前  
追加する時は  
下の空白をクリック > 新しい名前

---

## 一つのコントローラーで複数のものを扱う

コントローラーのハイパーウィンドウを開く > 繋げたいノードに線を伸ばす

---

# 4章　ジョイント

## ジョイント
リギングから`スケルトン > ジョイントの作成`で適当なところをクリックすると〇が出る。  
複数クリックすると、丸がたくさん出て親子付けされている。  

丸のサイズは`ディスプレイ > アニメーション > ジョイントサイズ`から調整できる。

---
## ジョイントのモデル貫通表示
ビュー画面の`シェーディング > ジョイントのX線表示`

---

## ジョイントの方向付け

Xは子のいる方向、zは同じ向き、yはベンドの後ろ  
設定方法は、`スケルトン > ジョイントの方向づけ`

手動でいじる場合は`F8コンポーネント化 > ?ボタンクリック（なければ隠れているのでlこんな感じのボタンをクリック）> いじりたいジョイントをドラッグで選ぶ`  
詰んだら[これ見て](https://area.autodesk.jp/movie/maya-lt-learning-channel/25.html)

コンポーネント選択のコツはy軸に向けて画面をずらして選択する？よーわからんので聞きましょう

---
## ジョイントコピー

コピーしたいジョイントをオブジェクトモードでアウトライナから選び、  
`スケルトン > ジョイントのミラー > オプション`  
ミラー平面をYZにすると、キャラクター中央上部を二分する平面

---

## シンプルなIK
- L_Shoulderを選んで`スケルトン > 優先回転角に設定する`Rも  
- `スケルトン > IKハンドルの作成で`先端と終端のジョイントをクリック
- IKがアウトライナに作成される。
- コントローラーを作成し手首に配置(トランスフォームのフリーズ、ヒストリ削除)
- 作成したIKを`ctrl+G`でグループ化
- `D+V`キーを押したままグループのピボットを手首にスナップ移動
- コントローラーとグループを選択して `コンストレイント > ペアレント`

---
## IKを含む全体の操作
- コントローラーを作成
- IKを操作するコントローラーを含め、全てそのコントローラーの子階層に
- おわり
---

## スキニング
- ルートジョイントを選択
- ctrl ジオメトリも選択
- `スキン > スキンのバインド > インタラクティブスキンバインド`を選択

バインドツールを使って調整するには
- 回転ツールでなんかのジョイントを回転させて曲げる
- ルートジョイントを選択
- `スキン > インタラクティブスキンバインドツール`  
カプセルをドラッグアンドドロップとかするといい

---

## ブレンドシェイプ
- ジオメトリを選んで`ctrl + D`で複製  
- 複製したジオメトリをいじった後、複製ジオメトリを選択して、元のジオメトリを選択し  
`デフォーム > ブレンドシェイプ(オプション)`で名前をつけよう。

追加するなら  
- 追加するジオメトリを選択、元のジオメトリを選択
- `デフォーム　> (編集)ブレンドシェイプ 追加`を選択

---

## コントローラーをブレンドシェイプに接続する

コントローラー作ってハイパーシェードで頑張って

---
## ブレンドシェイプウェイト

各ブレンドシェイプを微調整できます

- メインオブジェクトを選択して`デフォーマの編集 > （ウェイトのペン）ブレンドシェイプ option`
- 値はブレンドシェイプを適用する値ですね。0だと変更が加わりません。

